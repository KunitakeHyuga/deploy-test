(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const l="membersViewerApiBase",p="".trim()||"https://kunitake.net/members",w=s("#member-form"),u=s("#api-base-input"),m=s("#status-msg"),f=s("#member-result"),h=s("#clear-storage"),y=window.localStorage.getItem(l);u.value=y||p;g("まだ結果はありません");i("待機中","idle");w.addEventListener("submit",async e=>{e.preventDefault();const t=u.value.trim();window.localStorage.setItem(l,t),await E(t)});h.addEventListener("click",()=>{window.localStorage.removeItem(l),u.value=p});async function E(e){const t=L(e);i("呼び出し中…","loading"),g("レスポンスを待っています…");try{const r=await fetch(t,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`APIエラー: ${r.status} ${r.statusText}`);const c=await r.json();$(c),i("/members から最新の結果を取得しました","success")}catch(r){console.error(r),i("エラーが発生しました","error"),b(r instanceof Error?r.message:"不明なエラーです")}}function L(e){if(!e)return`${window.location.origin.replace(/\/$/,"")}/members`;const t=e.endsWith("/")?e:`${e}/`;try{return new URL("members",t).toString()}catch{throw new Error("有効なAPI URLを入力してください (例: https://example.com)")}}function $(e){const t=r=>r==null||r===""?"—":a(String(r));f.innerHTML=`
    <dl class="member-card">
      <dt>氏名</dt>
      <dd>${t(e.name)}</dd>
      <dt>学年</dt>
      <dd>${t(e.grade)}</dd>
      <dt>学籍番号</dt>
      <dd>${t(e.student_id)}</dd>
      <dt>備考</dt>
      <dd>${t(e.remark)}</dd>
    </dl>
    <div class="raw-json"><pre>${a(JSON.stringify(e,null,2))}</pre></div>
  `}function b(e){f.innerHTML=`<p class="placeholder">${a(e)}</p>`}function g(e){f.innerHTML=`<p class="placeholder">${a(e)}</p>`}function i(e,t){m.textContent=e,m.dataset.state=t}function a(e){return e.replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}function s(e){const t=document.querySelector(e);if(!t)throw new Error(`${e} が見つかりません`);return t}
